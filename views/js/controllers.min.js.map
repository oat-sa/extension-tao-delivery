{"version":3,"sources":["routes.js","tpl!taoDelivery/tpl/fullscreen-modal-feedback","runtime/service/fullScreen.js","runtime/service/deliveryExecution.js"],"names":["define","hb","template","Handlebars","depth0","helpers","partials","data","program1","stack1","helper","buffer","launchButton","call","hash","functionType","escapeExpression","program3","options","__","helperMissing","program5","this","compilerInfo","merge","self","unless","fsSupported","inverse","noop","fn","program","$","_","feedback","modal","dialogTpl","$dialog","$body","d","document","dElem","documentElement","fs","changeInterval","isSupported","exitFullscreen","msExitFullscreen","mozCancelFullScreen","webkitExitFullscreen","requestFullscreen","msRequestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","Element","ALLOW_KEYBOARD_INPUT","fullscreenchange","prefixes","i","length","fullScreen","fullscreenElement","mozFullScreen","webkitIsFullScreen","screen","availHeight","height","window","innerHeight","awaitFsChange","event","createEvent","initEvent","clearInterval","setInterval","dispatchEvent","handleUserInput","evt","type","keyCode","which","className","triggerResize","throttle","frame","getElementById","frameWindow","contentWindow","frame$","$win","trigger","init","body","addEventListener","replace","navigator","platform","toLowerCase","indexOf","querySelector","e","on","append","width","animate","disableClosing","startClosed","loadingBar","dialogAlert","logoutEvent","resizeMainFrame","outerHeight","$headerHeight","$footerHeight","$frameContainer","$frame","forceRepaint","$target","sel","style","display","offsetHeight","start","deliveryServerConfig","requireFullScreen","find","serviceApi","onFinish","ajax","url","finishDeliveryExecution","deliveryExecution","dataType","success","location","destination","onExit","exitDeliveryExecution","setTimeout","stop","message","action","off","loadInto","get"],"mappings":"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","file":"routes.js","sourcesContent":["/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2014 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\r\n * \r\n * \r\n */\r\n\r\n//@see http://forge.taotesting.com/projects/tao/wiki/Front_js\r\ndefine('taoDelivery/controller/routes',[],function(){\r\n    'use strict';\r\n\r\n    return {\r\n    };\r\n});\r\n\n","\ndefine('tpl!taoDelivery/tpl/fullscreen-modal-feedback', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, options, functionType=\"function\", escapeExpression=this.escapeExpression, helperMissing=helpers.helperMissing, self=this;\n\nfunction program1(depth0,data) {\n  \n  var buffer = \"\", stack1, helper;\n  buffer += \"(\";\n  if (helper = helpers.launchButton) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.launchButton); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \")\";\n  return buffer;\n  }\n\nfunction program3(depth0,data) {\n  \n  var buffer = \"\", helper, options;\n  buffer += \"\\r\\n            <button class=\\\"btn-info small enter-full-screen\\\" type=\\\"button\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Enter full screen\", options) : helperMissing.call(depth0, \"__\", \"Enter full screen\", options)))\n    + \"</button>\\r\\n            \";\n  return buffer;\n  }\n\nfunction program5(depth0,data) {\n  \n  var buffer = \"\", helper, options;\n  buffer += \"\\r\\n            <button class=\\\"btn-info small close-full-screen-prompt\\\" type=\\\"button\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Close this prompt\", options) : helperMissing.call(depth0, \"__\", \"Close this prompt\", options)))\n    + \"</button>\\r\\n            \";\n  return buffer;\n  }\n\n  buffer += \"<div class=\\\"modal-feedback modal full-screen-modal\\\">\\r\\n    <div class=\\\"modal-body clearfix\\\">\\r\\n        <p class=\\\"message\\\">\\r\\n            \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"This test needs to be taken in full screen mode\", options) : helperMissing.call(depth0, \"__\", \"This test needs to be taken in full screen mode\", options)))\n    + \"\\r\\n            \";\n  stack1 = helpers.unless.call(depth0, (depth0 && depth0.fsSupported), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\r\\n        </p>\\r\\n        <div class=\\\"rgt\\\">\\r\\n            \";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.fsSupported), {hash:{},inverse:self.program(5, program5, data),fn:self.program(3, program3, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\r\\n        </div>\\r\\n    </div>\\r\\n</div>\";\n  return buffer;\n  });\n});\n\n","/*\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2015 (original work) Open Assessment Technologies SA;\r\n *\r\n */\r\n\r\n/**\r\n *\r\n * @author dieter <dieter@taotesting.com>\r\n */\r\ndefine('taoDelivery/controller/runtime/service/fullScreen',[\r\n    'jquery',\r\n    'lodash',\r\n    'i18n',\r\n    'ui/feedback',\r\n    'ui/modal',\r\n    'tpl!taoDelivery/tpl/fullscreen-modal-feedback'\r\n], function ($, _, __, feedback, modal, dialogTpl) {\r\n    'use strict';\r\n\r\n    var $dialog;\r\n    var $body;\r\n    var d = document;\r\n    var dElem = d.documentElement;\r\n\r\n    var fs = {\r\n        changeInterval: null,\r\n\r\n        isSupported: !!(d.exitFullscreen ||\r\n                        d.msExitFullscreen ||\r\n                        d.mozCancelFullScreen ||\r\n                        d.webkitExitFullscreen),\r\n\r\n        requestFullscreen: dElem.requestFullscreen ||\r\n                    dElem.msRequestFullscreen ||\r\n                    dElem.mozRequestFullScreen ||\r\n                    function() {\r\n                        dElem.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);\r\n                    },\r\n\r\n                fullscreenchange: (function() {\r\n                    var prefixes = ['', 'ms', 'moz', 'webkit'],\r\n                        i = prefixes.length;\r\n                    while(i--) {\r\n                        if('on' + prefixes[i] + 'fullscreenchange' in dElem) {\r\n                            return prefixes[i] + 'fullscreenchange';\r\n                        }\r\n                    }\r\n                    return 'myfullscreenchange';\r\n                }()),\r\n\r\n        fullScreen: function() {\r\n            return !!(d.fullscreenElement || d.mozFullScreen || d.webkitIsFullScreen ||\r\n                        (screen.availHeight || screen.height - 30) <= window.innerHeight);\r\n        },\r\n\r\n        // on older browsers wait for a full screen change to happen\r\n        // and fire the change event manually\r\n        awaitFsChange : function() {\r\n            var event = d.createEvent('Event');\r\n            event.initEvent(fs.fullscreenchange, true, true);\r\n            clearInterval(fs.changeInterval);\r\n            fs.changeInterval = setInterval(function() {\r\n                if(!fs.fullScreen()) {\r\n                    d.dispatchEvent(event);\r\n                }\r\n            }, 2000);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * React to user input on the prompt which is either\r\n     * key press or click on the button\r\n     *\r\n     * @param evt\r\n     */\r\n    var handleUserInput = function handleUserInput (evt) {\r\n\r\n        // full screen needs to be initiated by pressing\r\n        // F11 (Windows/Linux) or Ctrl+Cmd+F (Mac)\r\n        if(!fs.isSupported) {\r\n            $dialog.modal('close');\r\n            return;\r\n        }\r\n\r\n        // accept 'enter' as only valid key stroke\r\n        if(evt.type === 'keydown' && (evt.keyCode || evt.which) !== 13) {\r\n            return;\r\n        }\r\n\r\n        // in all other cases either 'enter' has been hit or the enter button has been clicked\r\n        fs.requestFullscreen.call(dElem);\r\n        dElem.className += ' fullscreen';\r\n        $dialog.modal('close');\r\n    };\r\n\r\n    /**\r\n     * Triggers a resize\r\n     */\r\n    var triggerResize = (function() {\r\n        return _.throttle(function() {\r\n            var frame = document.getElementById('iframeDeliveryExec');\r\n            var frameWindow = frame && frame.contentWindow;\r\n            var frame$ = frameWindow && frameWindow.$;\r\n            var $win = frame$ && frame$(frameWindow) || $(window);\r\n            $win.trigger('resize');\r\n        }, 250);\r\n    })();\r\n\r\n    /**\r\n     * Initialize full screen\r\n     */\r\n    var init = function init() {\r\n\r\n        $body = $(document.body);\r\n\r\n        // listen either to the native or the change event created in the observer above\r\n        document.addEventListener(fs.fullscreenchange, function() {\r\n            if(!fs.fullScreen()) {\r\n                dElem.className = dElem.className.replace(/\\bfullscreen\\b/, '');\r\n                $dialog.modal('open');\r\n            } else {\r\n                triggerResize();\r\n            }\r\n        });\r\n        if (!fs.isSupported) {\r\n            fs.awaitFsChange();\r\n        }\r\n\r\n        modal($body);\r\n        $dialog = $(dialogTpl({\r\n            fsSupported: fs.isSupported,\r\n            // while this is vague chances that any Mac browser gets here are very little\r\n            launchButton: navigator.platform.toLowerCase().indexOf('Mac') === 0 ? 'Ctrl+âŒ˜+F' : 'F11'\r\n        }));\r\n\r\n        $dialog[0].querySelector('button').addEventListener('click', function(e) {\r\n            handleUserInput(e);\r\n        });\r\n\r\n        document.addEventListener('keydown', function(e) {\r\n            if(!fs.fullScreen()) {\r\n                handleUserInput(e);\r\n            }\r\n        });\r\n\r\n        $dialog.on('opened.modal', function() {\r\n            clearInterval(fs.changeInterval);\r\n        });\r\n\r\n        $dialog.on('closed.modal', function() {\r\n            if (!fs.isSupported) {\r\n                fs.awaitFsChange();\r\n                triggerResize();\r\n            }\r\n        });\r\n\r\n        $body.append($dialog);\r\n        \r\n        $dialog.modal({\r\n            width: 500,\r\n            animate: false,\r\n            disableClosing: true,\r\n            startClosed: true\r\n        });\r\n\r\n        // Note that when a page is on full screen already on load (after F5 normally)\r\n        // fullscreenElement and therefor fs.fullScreen() will report the wrong value!\r\n        if(false === ((screen.availHeight || screen.height - 30) <= window.innerHeight)) {\r\n            $dialog.modal('open');\r\n        }\r\n    };\r\n\r\n    /**\r\n     * @exports\r\n     */\r\n    return {\r\n        init: init\r\n    };\r\n});\r\n\n","/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2013 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\r\n *\r\n *\r\n */\r\ndefine('taoDelivery/controller/runtime/service/deliveryExecution',[\r\n    'lodash',\r\n    'jquery',\r\n    'taoDelivery/controller/runtime/service/fullScreen',\r\n    'layout/loading-bar',\r\n    'ui/dialog/alert',\r\n    'layout/logout-event'\r\n], function(_, $, fullScreen, loadingBar, dialogAlert, logoutEvent){\r\n    'use strict';\r\n\r\n    var $frameContainer,\r\n        $frame,\r\n        $headerHeight,\r\n        $footerHeight;\r\n\r\n    /**\r\n     * Forces a browser repaint\r\n     * Solution from http://stackoverflow.com/questions/3485365/how-can-i-force-webkit-to-redraw-repaint-to-propagate-style-changes?answertab=votes#tab-top\r\n     * @param {jQuery} $target\r\n     */\r\n    var forceRepaint = function($target) {\r\n        var sel = $target[0];\r\n        if (sel) {\r\n            sel.style.display = 'none';\r\n            sel.offsetHeight; // no need to store this anywhere, the reference is enough\r\n            sel.style.display = '';\r\n        }\r\n    };\r\n\r\n    function resizeMainFrame() {\r\n        var height = $(window).outerHeight() - $headerHeight - $footerHeight;\r\n        $frameContainer.height(height);\r\n        $frame.height(height);\r\n        forceRepaint($frameContainer);\r\n    }\r\n\r\n    return {\r\n        start: function(options){\r\n\r\n            if(!!options.deliveryServerConfig.requireFullScreen){\r\n                fullScreen.init();\r\n            }\r\n\r\n            $frameContainer = $('#outer-delivery-iframe-container');\r\n            $frame = $frameContainer.find('iframe');\r\n            $headerHeight = $('body > .content-wrap > header').outerHeight() || 0;\r\n            $footerHeight = $('body > footer').outerHeight() || 0;\r\n\r\n            $(document).on('serviceforbidden', function() {\r\n                logoutEvent();\r\n            });\r\n\r\n            var serviceApi = options.serviceApi;\r\n\r\n            serviceApi.onFinish(function() {\r\n                $.ajax({\r\n                    url : options.finishDeliveryExecution,\r\n                    data : {\r\n                        'deliveryExecution' : options.deliveryExecution\r\n                    },\r\n                    type : 'post',\r\n                    dataType : 'json',\r\n                    success : function(data) {\r\n                        window.location = data.destination;\r\n                    }\r\n                });\r\n            }).onExit(function() {\r\n                window.location = options.exitDeliveryExecution;\r\n            });\r\n\r\n            $(document)\r\n                .on('loading', function(e){\r\n                    loadingBar.start();\r\n                })\r\n                .on('unloading', function(){\r\n                    setTimeout(function(){\r\n                        loadingBar.stop();\r\n                    }, 300);\r\n                })\r\n                .on('messagealert', function(e, data) {\r\n                    if (data) {\r\n                        dialogAlert(data.message, data.action);\r\n                    }\r\n                })\r\n                .on('shutdown-com', function(){\r\n                    //use when we want to stop all exchange between frames\r\n                    $(document).off('heightchange');\r\n                    $frame.off('load.eventHeight')\r\n                           .off('load.cors');\r\n                });\r\n\r\n            serviceApi.loadInto($frame.get(0));\r\n\r\n            $(window).on('resize', _.throttle(function() {\r\n                resizeMainFrame();\r\n            }, 250));\r\n\r\n            resizeMainFrame();\r\n        }\r\n    };\r\n});\r\n\n"]}