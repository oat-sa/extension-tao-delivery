define("taoDelivery/controller/DeliveryServer/index",["jquery","lodash","module","core/router","ui/feedback","layout/loading-bar"],function($,_,module,router,feedback,loadingBar){"use strict";return{start:function(parameters){var deliveryStarted=!1,config=module.config();parameters&&parameters.messages&&_.forEach(parameters.messages,function(message){var level,content;level=message.level,content=message.content,level&&content&&feedback($(".permanent-feedback"))[level](content,{timeout:-1,popup:!1})}),$("a.entry-point").on("click",function(e){var url,$elt=$(this);e.preventDefault(),e.stopPropagation(),deliveryStarted||$elt.hasClass("disabled")||(
url=$elt.data().launch_url,_.isString(url)&&!_.isEmpty(url)&&(deliveryStarted=!0,loadingBar.start(),window.location.href=url))}),config&&_.isArray(config.extraRoutes)&&config.extraRoutes.length&&router.dispatch(config.extraRoutes)}}}),define("taoDelivery/controller/routes",[],function(){"use strict";return{}}),define("tpl!taoDelivery/tpl/fullscreen-modal-feedback",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,
helperMissing=helpers.helperMissing;return buffer+='<div class="modal-feedback modal full-screen-modal">\r\n    <div class="modal-body clearfix">\r\n        <p class="message">\r\n            '+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"This test needs to be taken in full screen mode",options):helperMissing.call(depth0,"__","This test needs to be taken in full screen mode",options)))+"\r\n            ",((stack1=helpers.unless.call(depth0,depth0&&depth0.fsSupported,{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var stack1,helper,buffer="";return buffer+="(",stack1=(
helper=helpers.launchButton)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.launchButton)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+")"},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+='\r\n        </p>\r\n        <div class="rgt">\r\n            ',((stack1=helpers.if.call(depth0,depth0&&depth0.fsSupported,{hash:{},inverse:this.program(5,function(depth0,data){var helper,options,buffer="";return buffer+='\r\n            <button class="btn-info small close-full-screen-prompt" type="button">'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__
)?helper.call(depth0,"Close this prompt",options):helperMissing.call(depth0,"__","Close this prompt",options)))+"</button>\r\n            "},data),fn:this.program(3,function(depth0,data){var helper,options,buffer="";return buffer+='\r\n            <button class="btn-info small enter-full-screen" type="button">'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Enter full screen",options):helperMissing.call(depth0,"__","Enter full screen",options)))+"</button>\r\n            "},data),data:data}))||0===stack1)&&(buffer+=stack1),buffer+="\r\n        </div>\r\n    </div>\r\n</div>"})}),define(
"taoDelivery/controller/runtime/service/fullScreen",["jquery","lodash","i18n","ui/feedback","ui/modal","tpl!taoDelivery/tpl/fullscreen-modal-feedback"],function($,_,__,feedback,modal,dialogTpl){"use strict";var $dialog,$body,d=document,dElem=d.documentElement,fs={changeInterval:null,isSupported:!!(d.exitFullscreen||d.msExitFullscreen||d.mozCancelFullScreen||d.webkitExitFullscreen),requestFullscreen:dElem.requestFullscreen||dElem.msRequestFullscreen||dElem.mozRequestFullScreen||function(){dElem.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)},fullscreenchange:function(){for(var prefixes=["","ms","moz","webkit"],i=prefixes.length;i--;)if(
"on"+prefixes[i]+"fullscreenchange"in dElem)return prefixes[i]+"fullscreenchange";return"myfullscreenchange"}(),fullScreen:function(){return!!(d.fullscreenElement||d.mozFullScreen||d.webkitIsFullScreen||(screen.availHeight||screen.height-30)<=window.innerHeight)},awaitFsChange:function(){var event=d.createEvent("Event");event.initEvent(fs.fullscreenchange,!0,!0),clearInterval(fs.changeInterval),fs.changeInterval=setInterval(function(){fs.fullScreen()||d.dispatchEvent(event)},2e3)}},handleUserInput=function(evt){fs.isSupported?"keydown"===evt.type&&13!==(evt.keyCode||evt.which)||(fs.requestFullscreen.call(dElem),dElem.className+=" fullscreen",$dialog.modal(
"close")):$dialog.modal("close")},triggerResize=_.throttle(function(){var frame=document.getElementById("iframeDeliveryExec"),frameWindow=frame&&frame.contentWindow,frame$=frameWindow&&frameWindow.$;(frame$&&frame$(frameWindow)||$(window)).trigger("resize")},250);return{init:function(){$body=$(document.body),document.addEventListener(fs.fullscreenchange,function(){fs.fullScreen()?triggerResize():(dElem.className=dElem.className.replace(/\bfullscreen\b/,""),$dialog.modal("open"))}),fs.isSupported||fs.awaitFsChange(),modal($body),($dialog=$(dialogTpl({fsSupported:fs.isSupported,launchButton:0===navigator.platform.toLowerCase().indexOf("Mac")?"Ctrl+âŒ˜+F":"F11"})
))[0].querySelector("button").addEventListener("click",function(e){handleUserInput(e)}),document.addEventListener("keydown",function(e){fs.fullScreen()||handleUserInput(e)}),$dialog.on("opened.modal",function(){clearInterval(fs.changeInterval)}),$dialog.on("closed.modal",function(){fs.isSupported||(fs.awaitFsChange(),triggerResize())}),$body.append($dialog),$dialog.modal({width:500,animate:!1,disableClosing:!0,startClosed:!0}),0==(screen.availHeight||screen.height-30)<=window.innerHeight&&$dialog.modal("open")}}}),define("taoDelivery/controller/runtime/service/deliveryExecution",["lodash","jquery","taoDelivery/controller/runtime/service/fullScreen",
"layout/loading-bar","ui/dialog/alert","layout/logout-event"],function(_,$,fullScreen,loadingBar,dialogAlert,logoutEvent){"use strict";var $frameContainer,$frame,$headerHeight,$footerHeight;function resizeMainFrame(){var sel,height=$(window).outerHeight()-$headerHeight-$footerHeight;$frameContainer.height(height),$frame.height(height),(sel=$frameContainer[0])&&(sel.style.display="none",sel.offsetHeight,sel.style.display="")}return{start:function(options){var serviceApi=options.serviceApi;options.deliveryServerConfig.requireFullScreen&&fullScreen.init(),$frameContainer=$("#outer-delivery-iframe-container"),$frame=$frameContainer.find("iframe"),
$headerHeight=$("body > .content-wrap > header").outerHeight()||0,$footerHeight=$("body > footer").outerHeight()||0,$(document).on("serviceforbidden",function(){logoutEvent()}),serviceApi.onFinish(function(){window.location=options.finishDeliveryExecution}).onExit(function(){window.location=options.exitDeliveryExecution}),$(document).on("loading",function(e){loadingBar.start()}).on("unloading",function(){setTimeout(function(){loadingBar.stop()},300)}).on("messagealert",function(e,data){data&&dialogAlert(data.message,data.action)}).on("shutdown-com",function(){$(document).off("heightchange"),$frame.off("load.eventHeight").off("load.cors")}),
serviceApi.loadInto($frame.get(0)),$(window).on("resize",_.throttle(function(){resizeMainFrame()},250)),resizeMainFrame()}}}),define("taoDeliveryloader\taoDelivery.bundle",function(){});
//# sourceMappingURL=taoDelivery.min.js.map